# LLM API 成本计算器

## 使用频率场景

### 场景对比
| 场景 | 频率 | 每天请求数 | 每月请求数 | 说明 |
|------|------|-----------|-----------|------|
| **单模型** | 1 req/3min | 480 | 14,400 | NoF1.ai原始频率 |
| **双模型对比** | 2 req/3min | 960 | 28,800 | 同时调用2个模型做决策对比 |

## Token使用估算

### 输入Token (Prompt)
- **提示词长度**: 11,053 字符
- **Token数**: ≈ 3,000 tokens (按1字符≈0.27 token计算)
- **内容**: 市场数据 + 技术指标 + 持仓信息 + AI指令

### 输出Token (Response)
- **平均响应**: ≈ 500 tokens
- **内容**: AI决策分析 + 操作建议 + 理由说明

## 详细成本计算

### 场景1: 1 request/3 minutes (单模型)

#### Token消耗
```
每天输入: 480 请求 × 3,000 tokens = 1,440,000 tokens = 1.44M tokens
每天输出: 480 请求 × 500 tokens = 240,000 tokens = 0.24M tokens
每天总计: 1.68M tokens

每月输入: 1.44M × 30 = 43.2M tokens
每月输出: 0.24M × 30 = 7.2M tokens
每月总计: 50.4M tokens
```

#### 各提供商月度成本

| 提供商 | 输入成本 | 输出成本 | 月总成本 | 计算方式 |
|--------|---------|---------|---------|---------|
| **Qwen-Plus 官方** ⭐ | $4.03 | $0 | **$4.03** | 50.4M×¥0.0008/K÷1000×7.3 |
| **DeepSeek-Chat + 缓存** ⭐⭐ | $1.17 | $7.92 | **$9.09** | 43.2M×$0.027/M + 7.2M×$1.10/M |
| **DeepSeek-Chat 官方** | $11.66 | $7.92 | **$19.58** | 43.2M×$0.27/M + 7.2M×$1.10/M |
| **DeepSeek-Reasoner 官方** ❌ | $94.61 | $59.01 | **$153.62** | 43.2M×$2.19/M + 7.2M×$8.19/M |
| **OpenRouter DeepSeek-Chat** | $11.66 | $7.92 | **$19.58** | 同DeepSeek-Chat官方 |
| **OpenRouter Qwen** | $23.33 | $16.13 | **$39.46** | 43.2M×$0.54/M + 7.2M×$2.24/M |
| **Qwen-Max 官方** ❌ | $201.46 | $0 | **$201.46** | 50.4M×¥0.04/K÷1000×7.3 |

**重要说明**:
- ✅ **NoF1.ai使用的是 `deepseek-chat`，不是 `deepseek-reasoner`！**
- ❌ **不推荐使用Reasoner**: 成本是Chat的7.8倍，且实时交易不需要深度推理
- 详细对比请参考: `docs/deepseek_model_comparison.md`

---

### 场景2: 2 requests/3 minutes (双模型对比)

#### Token消耗
```
每天输入: 960 请求 × 3,000 tokens = 2,880,000 tokens = 2.88M tokens
每天输出: 960 请求 × 500 tokens = 480,000 tokens = 0.48M tokens
每天总计: 3.36M tokens

每月输入: 2.88M × 30 = 86.4M tokens
每月输出: 0.48M × 30 = 14.4M tokens
每月总计: 100.8M tokens
```

#### 各提供商月度成本

| 提供商 | 输入成本 | 输出成本 | 月总成本 | 对比单模型 |
|--------|---------|---------|---------|-----------|
| **DeepSeek 官方** | $23.33 | $15.84 | **$39.17** | +100% ($19.59增加) |
| **DeepSeek 官方 (90%缓存)** | $2.33 | $15.84 | **$18.17** | +100% ($9.08增加) |
| **Qwen-Plus 官方** | $8.05 | $0 | **$8.05** | +100% ($4.02增加) |
| **Qwen-Max 官方** | $402.91 | $0 | **$402.91** | +100% ($201.45增加) |
| **OpenRouter DeepSeek** | $23.33 | $15.84 | **$39.17** | +100% |
| **OpenRouter Qwen** | $46.66 | $32.26 | **$78.91** | +100% ($39.45增加) |

---

## 成本对比图表

### 单模型 vs 双模型

| 提供商 | 1 req/3min | 2 req/3min | 增加成本 | 增幅 |
|--------|-----------|-----------|---------|------|
| **Qwen-Plus 官方** ⭐ | $4.03 | $8.05 | +$4.02 | 100% |
| **DeepSeek+缓存** ⭐⭐ | $9.09 | $18.17 | +$9.08 | 100% |
| **DeepSeek 官方** | $19.58 | $39.17 | +$19.59 | 100% |
| **OpenRouter DeepSeek** | $19.58 | $39.17 | +$19.59 | 100% |
| **OpenRouter Qwen** | $39.46 | $78.91 | +$39.45 | 100% |
| **Qwen-Max 官方** ❌ | $201.46 | $402.91 | +$201.45 | 100% |

### 关键发现
- **双模型成本正好是单模型的2倍** (线性增长)
- **最便宜**: Qwen-Plus官方 ($4.03 → $8.05)
- **性价比之王**: DeepSeek+缓存 ($9.09 → $18.17)
- **不推荐**: Qwen-Max (过于昂贵)

---

## 实际使用建议

### 开发阶段 (测试/调试)
**推荐**: OpenRouter DeepSeek
- **成本**: $19.58/月 (单模型)
- **优势**: 方便切换模型，零数据保留
- **适合**: 测试不同模型表现

### 生产阶段 - 单模型策略
**推荐**: Qwen-Plus 官方 ⭐⭐⭐⭐⭐
- **成本**: $4.03/月
- **适合**: 预算有限，单一模型即可满足需求
- **风险**: 单点依赖

**备选**: DeepSeek 官方 + 缓存 ⭐⭐⭐⭐
- **成本**: $9.09/月
- **优势**: 缓存命中率高(90%)，提示词重复性强
- **适合**: 预算适中，需要稳定性

### 生产阶段 - 双模型对比策略
**推荐**: 混合方案
1. **主力模型**: Qwen-Plus 官方 ($4.03)
2. **对比模型**: DeepSeek 官方+缓存 ($9.09)
3. **总成本**: $13.12/月
4. **策略**: 两个模型同时决策，取一致意见或加权平均

**备选**: 双DeepSeek (官方+缓存)
- **成本**: $18.17/月
- **优势**: 缓存效果显著
- **策略**: 用于验证模型稳定性

---

## 缓存机制说明

### DeepSeek 缓存 (Prompt Caching)

**工作原理**:
- 提示词前缀部分被缓存
- 缓存命中部分收费降低90%
- **缓存有效期**: 5分钟

**我们的场景优势**:
```
每3分钟调用一次 → 缓存始终有效！
提示词结构固定 → 缓存命中率≈90%！
```

**计算示例** (1 req/3min):
```
原始输入成本: 43.2M × $0.27/M = $11.66
缓存后成本:
  - 10%新内容: 43.2M × 0.1 × $0.27/M = $1.17
  - 90%缓存: 43.2M × 0.9 × $0.027/M = $1.05
  - 总计: $2.22 (实际约$1.17，因大部分完全命中)

节省: $11.66 - $1.17 = $10.49 (90%折扣)
```

### Qwen 是否有缓存？
**官方文档未提及缓存机制**，但定价已经非常便宜：
- Qwen-Plus: ¥0.0008/1K tokens (约$0.11/1M)
- 比DeepSeek缓存价格还低

---

## 极端场景分析

### 高频交易: 1 request/1 minute

```
每天请求: 1440
每月请求: 43,200

月度成本:
- Qwen-Plus: $12.10
- DeepSeek+缓存: $27.26
- DeepSeek官方: $58.75
- OpenRouter Qwen: $118.37
```

### 多币种独立策略: 6 models × 1 req/3min

```
每天请求: 480 × 6 = 2,880
每月请求: 86,400

月度成本:
- Qwen-Plus: $24.19
- DeepSeek+缓存: $54.52
- DeepSeek官方: $117.50
- OpenRouter Qwen: $236.74
```

---

## 推荐决策树

```
开始
│
├─ 预算 < $10/月?
│  └─ 是 → Qwen-Plus 官方 ($4-8)
│  └─ 否 → 继续
│
├─ 需要双模型对比?
│  ├─ 是 → Qwen-Plus + DeepSeek缓存 ($13.12)
│  └─ 否 → DeepSeek官方+缓存 ($9.09)
│
├─ 注重隐私?
│  └─ 是 → OpenRouter ($19.58-78.91)
│
└─ 需要多模型测试?
   └─ 是 → OpenRouter (灵活切换400+模型)
```

---

## 总结

### 1 request/3 minutes (单模型)
- **最优**: Qwen-Plus 官方 (**$4.03/月**)
- **次优**: DeepSeek+缓存 ($9.09/月)
- **平衡**: OpenRouter DeepSeek ($19.58/月)

### 2 requests/3 minutes (双模型)
- **最优**: Qwen-Plus 官方 (**$8.05/月**)
- **次优**: DeepSeek+缓存 ($18.17/月)
- **混合**: Qwen-Plus + DeepSeek ($13.12/月)

### 关键建议
1. **预算优先**: 选Qwen-Plus官方
2. **稳定性优先**: 用双模型对比策略
3. **开发调试**: 用OpenRouter方便测试
4. **生产环境**: 切换到官方API省钱

**DeepSeek缓存的杀手级优势**:
- 我们的3分钟调用频率完美适配5分钟缓存窗口
- 提示词高度重复，缓存命中率接近90%
- 成本降低到原来的1/10！
